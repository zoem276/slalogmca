<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>スラロームゲート採点</title> <!-- Updated title to Japanese -->
    <style>
        /* スマホ用のスタイル */
        .input-flex-row {
            display: flex;
            gap: 5px;
            justify-content: left-start; /*center;*/ /* 左揃え */   
            align-items: left; /*center; */ /* 縦方向を中央揃え */
            /*flex-wrap: wrap;*/ /* 画面が極端に狭い場合は自動で折り返し */
        }
        .input-group {
            display: inline-block;
            margin-right: 20px;
            text-align: center;
        }
        .input-container {
            display: inline-block;
            margin-right: 20px;
            text-align: center;
        }
        .input-label {
            font-size: 12px;
            color: black;
            display: block;
        }
        .input-container { 
            font-size: 12px; /*bib*/
            color: black;
            display: block;
        }

        p {
            text-align: center; /* テキストを中央揃え */
        }

        .number-container {
            display: flex; /* 横並びにする */
            justify-content: center; /* 中央揃え */
            gap: 20px; /* ボックス間の余白 */
        }

        .number-box {
            width: 50px; /* 入力ボックスの幅を調整 */
            text-align: center;
            font-size: 20px;
        }


        /* スピナーを消すためのCSS 追加*/
        input[type=number]::-webkit-outer-spin-button,
        input[type=number]::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        input[type=number] {
            -moz-appearance: textfield;
            appearance: textfield;
        }

    </style>
</head>
<body>
  
<div class="input-group"> <!--container-->
<!--    <div class="row">
        <div class="col-md-12"> -->
            <h4>ゲート採点</h4>
      <!--      <form> -->
                <div class="input-flex-row">
                    <div class="input-container">
                        <label for="classInput" class="input-label">クラス</label>
                        <input type="number" class="form-control input-box" id="classInput" name="class"  style="width: 50px; text-align: center; font: bold; font-size: 28px; background-color:orange ;"min="1" max="30">
                    </div>
                    <div class="input-container"> 
                        <label for="runInput" class="input-label">RUN</label>
                        <input type="number" class="form-control input-box" id="runInput" name="run" style="width: 50px; text-align: center; font: bold; font-size: 28px; background-color: rgb(208, 255, 80);" min="1" max="2"> 
                    </div>

                    <div class="input-container">
                        <label for="bibNumberInput" class="input-label">BIBNo</label>
                        <input type="number" class="form-control input-box" id="bibNumberInput" name="bibNumber" style="width: 50px; text-align: center; font: bold; font-size: 28px; background-color:hotpink; color: black;"  >
      
                    </div>
                </div>

       <!-- </form> -->
            <form>
              <fieldset>
                <!-- <legend>採点してください。</legend> -->
                <div class="row-container">
                  <!-- <button onclick="toggleVisibility(this)">x</button> -->
                  <label for="gate-field1">&thinsp;GNo</label>
                  <input type="number" id="gate-field1" name="gate-field1" required> 
                  <input type="radio" id="contactChoice1" name="contact1" value="0" />
                  <label for="contactChoice1">0</label>
                  <input type="radio" id="contactChoice2" name="contact1" value="2" />
                  <label for="contactChoice2">2</label>
                  <input type="radio" id="contactChoice3" name="contact1" value="50" />
                  <label for="contactChoice3">50</label>
                  <input type="radio" id="contactChoice4" name="contact1" value="dsq-r" />
                  <label for="contactChoice4">dsqr</label>
                </div>
              </fieldset>                
              <fieldset>
                <div class="row-container">
                    <button onclick="toggleVisibility(this)">×</button>
                    <label for="gate-field2">GNo</label>
                    <input type="number" id="gate-field2" name="gate-field2" required> 
                    <input type="radio" id="contactChoice5" name="contact2" value="0" />
                    <label for="contactChoice5">0</label>
                    <input type="radio" id="contactChoice6" name="contact2" value="2" />
                    <label for="contactChoice6">2</label>
                    <input type="radio" id="contactChoice7" name="contact2" value="50" />
                    <label for="contactChoice7">50</label> 
                    <input type="radio" id="contactChoice8" name="contact2" value="dsq-r" />
                    <label for="contactChoice8">dsqr</label> 
                  </div>
              </fieldset>
              <fieldset>
                <div class="row-container">
                    <button onclick="toggleVisibility(this)">×</button>
                    <label for="gate-field3">GNo</label>
                    <input type="number" id="gate-field3" name="gate-field3" required> 
                    <input type="radio" id="contactChoice9" name="contact3" value="0" />
                    <label for="contactChoice9">0</label>
                    <input type="radio" id="contactChoice10" name="contact3" value="2" />
                    <label for="contactChoice10">2</label>
                    <input type="radio" id="contactChoice11" name="contact3" value="50" />
                    <label for="contactChoice11">50</label> 
                    <input type="radio" id="contactChoice12" name="contact3" value="dsq-r" />
                    <label for="contactChoice12">dsqr</label>
                </div>
              </fieldset>
                <fieldset>
                    <div class="row-container">
                        <button onclick="toggleVisibility(this)">×</button>
                        <label for="gate-field4">GNo</label>
                        <input type="number" id="gate-field4" name="gate-field4" required> 
                        <input type="radio" id="contactChoice13" name="contact4" value="0" />
                        <label for="contactChoice13">0</label>
                        <input type="radio" id="contactChoice14" name="contact4" value="2" />
                        <label for="contactChoice14">2</label>
                        <input type="radio" id="contactChoice15" name="contact4" value="50" />
                        <label for="contactChoice15">50</label> 
                        <input type="radio" id="contactChoice16" name="contact4" value="dsq-r" />
                        <label for="contactChoice16">dsqr</label>
                    </div>
              </fieldset>
              <!-- 未使用　使用は保存のカウンター4->5にすること -->
              <!--  <fieldset>
                <div class="row-container">
                    <button onclick="toggleVisibility(this)">×</button>
                    <label for="gate-field5">GNo</label>
                    <input type="number" id="gate-field5" name="gate-field5" required> 
                    <input type="radio" id="contactChoice17" name="contact5" value="0" />
                    <label for="contactChoice17">0</label>
                    <input type="radio" id="contactChoice18" name="contact5" value="2" />
                    <label for="contactChoice18">2</label>
                    <input type="radio" id="contactChoice19" name="contact5" value="50" />
                    <label for="contactChoice19">50</label> 
                    <input type="radio" id="contactChoice20" name="contact5" value="dsq-r" />
                    <label for="contactChoice20">dsqr</label>
                </div>
              </fieldset> -->

              <button id="saveButton" type="submit">保存</button> 
              <button id="showDataButton" type="submit">show</button>
              <button id="clearDataButton" type="submit">clear</button>
              <button id="mailButton" type="submit">Mail</button>
              <button id="returnButton" type="submit">目次へ</button>    
            </div>
            <div>
              <button id="fileButton" type="submit">ダウンロード</button> 
              
                           
            </div>
            </form>
        </div>
    </div>
</div>

<style>
        #classInput {
            width: 50px; 
            text-align: center;
            font-size: 20px;
            background-color: violet;
            margin-bottom: 10px; /* クラス入力ボックスの下に余白を追加 */
        }
    
    /* スマホサイズに対応するスタイル */
    @media (max-width: 600px) {
        .input-flex-row {
            display: flex;
            gap: 20px;
            justify-content: center; /* これで中央揃え */
        }
        .input-container {
            flex-direction: column;  /* スマホでは縦並びにする */
            align-items: center;
            display: flex; /*block;*/
            margin: 0 0 0 0;
            width: 100%;
            text-align: center; /*ラベルの位置 */
        }
        .input-label {
            font-size: 10px;
            margin-bottom: 2px;
            line-height: 1.1;
        }
        .input-box {
            width: 50px; /* 入力ボックスを画面幅に合わせる */
        }


        button {
            width: 50px; /* ボタンを画面幅に合わせる */
            font-size: 16px; /* ボタンのフォントサイズを調整 */
        }

        h2 {
            font-size: 32px; /*32 見出しのフォントサイズを調整 */
            /* text-align: center; /* 見出しを中央揃え */
        }
        #classInput {
            width: 50px; 
            text-align: center;
            font-size: 20px;
            background-color: violet;
            margin-bottom: 10px; /* クラス入力ボックスの下に余白を追加 */
        }
       #runInput {
            width: 50px; 
            text-align: center;
            font-size: 20px;
            background-color: yellow;

        }
        #bibNumberInput {
            width: 80px; 
            text-align: center;
            font-size: 32px; /*42 ゼッケンNoのフォントサイズを調整 */
            background-color: lightgreen; 
        }
    }
</style>
</body>

<style>
        body {
            font-size: 20px;
            line-height: 1.0;
            margin: 0;
            padding: 10px;
        }

        #saveButton {
            width: 80px; /*100*/
            height: 40px; /* Updated height */
            font-size: 18px; /* Fixed typo */
            padding: 1px 1px; /* 枠内側 */
            color: white; /* 文字色 */
            font-weight: bold; /* 太字 */
            border-radius: 10px; /* 角丸 */
            background-color: blue; /* ボタン色 */

            margin-top: 10px;
        }

        .data-container {
            margin-top: 20px;
            max-height: 150px; /* 表示領域の高さを制限 */
            overflow-y: auto; /* 溢れた場合にスクロール */
            border: 1px solid #ccc;
            padding: 10px;
            background-color: #f9f9f9;
            font-size: 18px; /* 文字サイズを14pxに設定 */
            line-height: 1.2; /* 行間を狭く設定 */
        }
        
        .data-container p {
        margin: 2px 0; /* 行間をさらに狭くする */
        }
        .button-container {
            margin-top: 1px;
            display: flex;
            justify-content: right;
            gap: 10px;
        }

        button {
            font-size: 14px; /* フォントサイズを12pxに設定 */
            padding: 3px 2px; /* Updated padding */
            cursor: pointer;
        }
        #showDataButton {
            width: 60px; /* Updated width */
            height: 30px; /* Updated height */
            font-size: 20px; /* Fixed typo */
            padding: 1px 1px; /* 枠内側 */
            color: black; /* 文字色 */
            font-weight: bold; /* 太字 */
            border-radius: 10px; /* 角丸 */
            background-color: lightgreen; /* ボタン色 */
        }
        #clearDataButton {
            width: 60px; /* Updated width */
            height: 30px; /* Updated height */
            font-size: 20px; /* Fixed typo */
            padding: 1px 1px; /* 枠内側 */
            color: black; /* 文字色 */
            font-weight: bold; /* 太字 */
            border-radius: 10px; /* 角丸 */
            background-color: orange; /* ボタン色 */
        }

        #fileButton { /*ダウンロードBTN*/
            display: none; /* 初期状態では非表示 */
            width: 50px; /* Updated width */
            height: 30px; /* Updated height */
            font-size: 11px; /* Fixed typo */
            padding: 1px 1px; /* 枠内側 */
            color: black; /* 文字色 */
            font-weight: bold; /* 太字 */
            border-radius: 10px; /* 角丸 */
            background-color: orange; /* ボタン色 */
        }
        #mailButton {
            width: 60px; /* Updated width */
            height: 30px; /* Updated height */
            font-size: 20px; /* Fixed typo */
            padding: 1px 1px; /* 枠内側 */
            color: white; /* 文字色 */
            font-weight: bold; /* 太字 */
            border-radius: 10px; /* 角丸 */
            background-color: purple; /* ボタン色 */
        }
        #returnButton {
            width: 60px; /* Updated width */
            height: 30px; /* Updated height */
            font-size: 18px; /* Fixed typo */
            padding: 1px 1px; /* 枠内側 */
            color: white; /* 文字色 */
            font-weight: bold; /* 太字 */
            border-radius: 10px; /* 角丸 */
            background-color: green; /* ボタン色 */
        }


 /*   #gate-field {       /*ゲートNoを入れるところ */
 /*       width: 2ch; /* 2文字分の幅を設定 */
 /*       text-align: right; /* center; /* テキストを中央揃え */
 /*       font-size: 32; /*20 必要に応じてフォントサイズを調整 */
 /*       font-weight: bold; */
 /*   } */


    input[type="radio"] + label {
        margin-left: 5px; /*-5 ラジオボタンとラベルの間を狭くする */
    }
</style>

<style> /* ゲート部の書式 */
    .row-container {
        display: flex;
        align-items: center;
        gap: 1; /*1 要素間の余白を調整 */
        flex-wrap: wrap; /* 必要に応じて折り返し */
    }

    .row-container label {
        margin: -2; /* 0ラベルの余白をなくす */
    }

    .row-container input[type="number"] {
        width: 3ch; /*3 ゲートnoを入れるところ入力ボックスの幅を調整 */
        text-align: center; /*right テキストを右揃え */
        font-size: 18px; /*20 フォントサイズを調整 */
        font-weight: normal; /* 太字 bold*/
        color: blue;
        /* ゲートNoの範囲はHTML属性で設定してください */
    }

    .row-container input[type="radio"] + label {
        margin-left: -5px; /*-5 ラジオボタンとラベルの間を調整 */
    }

button{
    font-size: 12px; /* Xボタンのフォントサイズを調整 */
    padding: 0; /* 内側の余白をなくす */
    width: 2ch; /* ボタンの幅を1.5文字分に設定 */
    height: 5ch; /* ボタンの高さを1.5文字分に設定 */
    text-align: right; /* テキストを右揃え */
    line-height: 2ch; /* テキストの高さをボタンに合わせる */
    border-radius: 20%; /* 角丸いボタンにする */
    background-color: red; /* ボタンの背景色 */
    color: white; /* ボタンの文字色 */
    border: none; /* ボタンの枠線をなくす */
    cursor: pointer; /* カーソルをポインタに変更 */
}
</style>

<style>
    .row-container {
        display: flex;
        align-items: center;
        gap: 0px; /* 要素間の余白 */
        justify-content: flex-start; /* ← 左寄せ追加 */
    }

    .hidden {
        display: none !important; /* 非表示にするクラス */
    }
</style>

<style> button{      
        font-size: 24px; /*20 GNoボタンのフォントサイズを調整 */
        padding: 0; /* 内側の余白をなくす */
        width: 1ch; /* ボタンの幅を1.5文字分に設定 */
        height: 2ch; /* ボタンの高さを1.5文字分に設定 */
        text-align: center; /* テキストを中央揃え */
        line-height: 2ch; /* テキストの高さをボタンに合わせる */
        border-radius: 20%; /* 丸いボタンにする */
        background-color: red; /* ボタンの背景色 */
        color: white; /* ボタンの文字色 */
        border: 1px solid; /* ボタンの枠線をなくす */
        cursor: pointer; /* カーソルをポインタに変更 */
    }

    @media (max-width: 450px) {
        button {
            width: 12px; /* スマホ用に幅を1.5文字分に設定 */
            height: 2ch; /* スマホ用に高さを2.0文字分に設定 */ 
            font-size: 20px; /* スマホ用にフォントサイズを小さく */
            text-align: center; /* テキストを中央揃え */
        }
            /* XボタンとG文字をくっつける */
        .row-container button {
            margin-right: -4px; /*0 ボタンの右側の余白をなくす */
            margin-left: -4px; /*0 ボタンの左側の余白をなくす */
            margin-top: -2px; /*0 ボタンの上側の余白をなくす */
            margin-bottom: -2px; /*0 ボタンの下側の余白をなくす */
        }

        .row-container label[for="gate-field"] {
            margin-left: -4px; /*0 G文字の左側の余白をなくす */
        }

        /* GNo文字とinputボックスをくっつける */
        #gate-field {
            margin-left: -5; /*0 inputボックスの左側の余白をなくす */
        }

        /* 行全体のスタイル調整 */
        .row-container {
            display: flex;
            align-items: center; /*center*/
            gap: 0; /*5 要素間の余白を最小限に設定 */
        }
    }
</style>

<style>
    /* XボタンとG文字をくっつける */
    .row-container button {
        margin-right: -4px; /*0 ボタンの右側の余白をなくす */
        margin-left: -4px; /*0 ボタンの左側の余白をなくす */
        margin-top: -2px; /*0 ボタンの上側の余白をなくす */
        margin-bottom: -2px; /*0 ボタンの下側の余白をなくす */
    }

    .row-container label[for="gate-field"] {
        margin-left: -4px; /*0 G文字の左側の余白をなくす */
    }

    /* GNo文字とinputボックスをくっつける */
    #gate-field {
        margin-left: 0; /*0 inputボックスの左側の余白をなくす */
    }

    /* 行全体のスタイル調整 */
    .row-container {
        display: flex;
        align-items: center; /*center*/
        gap: 5; /*5 要素間の余白を最小限に設定 */
    }
</style>

<body>
    <div class="button-container"> 
        <!--<button id="saveButton">保存</button>
        <button id="showDataButton">show</button>
        <button id="clearDataButton">clear</button>
        <button id="fileButton">File</button>-->
    </div>
       
    <div class="data-container" id="dataContainer">
        <!-- 保存されたデータがここに表示される--> 
    </div>

    <script>
        const dataContainer = document.getElementById("dataContainer");

        // データ一覧を表示する
        document.getElementById("showDataButton").addEventListener("click", function () {
            event.preventDefault(); // フォームのデフォルト動作を無効化フォームリセット防ぐ
            const savedData = localStorage.getItem("GATsavedData");
            if (savedData) {
                const dataList = savedData.split("\n");
                dataContainer.innerHTML = dataList.map(data => `<p>${data}</p>`).join("");
            } else {
                dataContainer.innerHTML = "<p>保存されたデータはありません。</p>";
            }
            // ページ最終行へジャンプ
            dataContainer.scrollTop = dataContainer.scrollHeight;
        });

        // データを削除する
        document.getElementById("clearDataButton").addEventListener("click", function () {
            event.preventDefault(); // フォームのデフォルト動作を無効化フォームリセット防ぐ
            const confirmDelete = confirm("データを削除しますか？ (Y/N)");
            if (confirmDelete) {
                localStorage.removeItem("GATsavedData");
                dataContainer.innerHTML = "<p>データが削除されました。</p>";
                // 追加: データ削除後に表示を更新
                const savedData = localStorage.getItem("GATsavedData");
                if (savedData) {
                    const dataList = GATsavedData.split("\n"); // Fixed variable name
                    dataContainer.innerHTML = dataList.map(data => `<p>${data}</p>`).join("");
                } else {
                    dataContainer.innerHTML = "<p>保存されたデータはありません。</p>";
                }
            }
        });

        // 保存ボタンのクリックイベント非表示部を無視する
        document.getElementById("saveButton").addEventListener("click", function (event) {
            event.preventDefault(); // フォームのデフォルト動作を無効化フォームリセット防ぐ
            const classInput = document.getElementById("classInput").value;
            const runInput = document.getElementById("runInput").value;
            const bibNumberValue = document.getElementById("bibNumberInput").value;

            // 入力チェック
            if (!classInput || !runInput || !bibNumberValue) {
                alert("すべての項目を入力してください。");
                return;1
            }

            // データを保存する
            // ゲートフィールドとラジオボタンの値を収集
            const gateData = [];
            for (let i = 1; i <= 4; i++) {
                const gateField = document.getElementById(`gate-field${i}`);
                const parentDiv = gateField.closest(".row-container"); // 親要素を取得

                // 非表示の行はスキップ
                if (parentDiv && parentDiv.querySelector('input, label') && parentDiv.querySelector('input').classList.contains("hidden")) {
                    continue;
                }

                // 表示されている場合は必ずチェック
                const radioButton = document.querySelector(`input[name="contact${i}"]:checked`);

                // GNoもラジオも未入力なら何もしない（スキップ）
                if (!gateField.value && !radioButton) {
                    //continue;
                    alert(`ゲート${i}番目のGNoとラジオボタンが選択されていません。`);
                    return;
                }
                // GNo未入力だがラジオだけ選択→エラー
                if (!gateField.value && radioButton) {
                    alert(`ゲート${i}番目のGNoが入力されていません。`);
                    return;
                }
                // GNoは入力済みだがラジオ未選択→エラー
                if (gateField.value && !radioButton) {
                    alert(`ゲート${i}番目のラジオボタンが選択されていません。`);
                    return;
                }
                // 両方入力されていれば保存
                gateData.push(`g${gateField.value},p${radioButton.value}`);
            
            }            

            // 書式に従ってデータを作成
            const formattedData = `c${classInput},r${runInput},z${bibNumberValue},${gateData.join(",")}/`; // 例: c1,r2,z123,g1,p0,g2,p2,g3,p50,g4,dsqr

            // 保存処理
            const existingData = localStorage.getItem("GATsavedData") || "";
            const updatedData = existingData ? `${existingData}\n${formattedData}` : formattedData;
            localStorage.setItem("GATsavedData", updatedData);

            console.log("保存されたデータ:", formattedData);

            // 入力フィールドをリセット(bibNoとラジオボタン)
            setTimeout(() => {
                document.getElementById("bibNumberInput").value = "";
                document.getElementById("bibNumberInput").focus();

            // ラジオボタンの選択を解除
            for (let i = 1; i <= 4; i++) {
                const radioButtons = document.querySelectorAll(`input[name="contact${i}"]`);
                radioButtons.forEach((radio) => {
                    radio.checked = false; // ラジオボタンをオフにする
                });
            }

            

            }, 500);
            // 保存fileを表示して、ページ最終行へジャンプ            
            const savedData = localStorage.getItem("GATsavedData");
            if (savedData) {
                const dataList = savedData.split("\n");
                dataContainer.innerHTML = dataList.map(data => `<p>${data}</p>`).join("");
            } else {
                dataContainer.innerHTML = "<p>保存されたデータはありません。</p>";
            }
            // ページ最終行へジャンプ
            dataContainer.scrollTop = dataContainer.scrollHeight;
        });
        
        //Xボタンの設定　ゲートNoとラジオボタンを非表示にする
            //--Xボタンは見える〇-表示部chkされるX-------------
        function toggleVisibility(button) {
            const parentDiv = button.parentElement; // ボタンの親要素を取得
            const elementsToHide = parentDiv.querySelectorAll("label, input"); // 非表示にする要素を選択

            // gate-field を空文字に設定
            const gateField = parentDiv.querySelector('input[type="number"]');

            if (gateField) {
                gateField.value = ""; // gate-field を空文字にする
            }

            // ラジオボタンの選択を解除
            const radioButtons = parentDiv.querySelectorAll('input[type="radio"]');
            radioButtons.forEach((radio) => {
                radio.checked = false; // ラジオボタンをオフにする
            });

            // 要素の表示/非表示を切り替え
            elementsToHide.forEach((element) => {
                if (element.classList.contains("hidden")) {
                    element.classList.remove("hidden"); // 非表示を解除
                } else {
                    element.classList.add("hidden"); // 非表示にする
                }
            });
        }

</script>
<script>
    // ファイルダウンロード
    document.getElementById("fileButton").addEventListener("click", function(event) {
    event.preventDefault();

    // 保存データを取得
    const savedData = `gate/${localStorage.getItem("GATsavedData") || ""}end`;
    const filename = "gatefile.txt";

    // Blobを使ってファイルを作成
    const blob = new Blob([savedData], { type: "text/plain" });
    const url = URL.createObjectURL(blob);

    // ダウンロード用リンクを作成してクリック
    const a = document.createElement("a");
    a.href = url;
    a.download = filename;
    a.click();

    // メモリ解放
    URL.revokeObjectURL(url);
    });

    // メール送信
    document.getElementById("mailButton").addEventListener("click", function(event) {
    event.preventDefault();

    // 保存データを取得
    const rawData = localStorage.getItem("GATsavedData");
    if (!rawData) {
        alert("保存されたデータはありません。");
        return;
    }
    const savedData = `gate/${rawData.replace(/\n/g, "")}end`;


    // メール本文用にエンコード
    const body = encodeURIComponent(savedData);
    const subject = encodeURIComponent("スラローム採点");

    //*****************************************************************************
    const to = "Acc-Mca@outlook.jp";
    const cc = "ikzee.418@outlook.jp";

    // mailtoリンクを作成して開く
    window.location.href = `mailto:?to=${to}?cc=${cc}?subject=${subject}&body=${body}`;
    //window.location.href = `mailto:?subject=${subject}&body=${body}`;
});

    // メニューへ戻る
    document.getElementById("returnButton").addEventListener("click", function(event) {
    event.preventDefault();
    // メニューへ戻る処理
    window.location.href = "index.html";
});
</script>
</body>
</html>